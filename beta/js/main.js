var wait;var requestajax=null;var fst_l=1;var last_m=false;var ajax_c=false;var time_out_m;var url_page=""+window.location.href;var title_page_="";var twinkle_;var focuset=true;var c_message;$(document).ready(function(a){$(".link_mail").on("click",function(c){c.preventDefault();document.location.replace("mailto:"+$(this).attr("data-hash"))});if($(".login_form").length<1){c_message=parseInt($(".nav-h .mess_count").html());var b="";if(c_message>0){b=" red"}$(".navbar-header").append('<span class="mess_count'+b+'">'+c_message+"</span>")}else{c_message=0}$(".open-all-com").on("click",function(c){c.preventDefault();open_all_coms()});$(document).on("focusout",function(){focuset=false});$(document).on("focusin",function(){focuset=true;clearTimeout(twinkle_);document.title=title_page_});title_page_=document.title;$.ajaxSetup({cache:false});time_out_m=setTimeout(function(){update_mess_count()},49999);$(window).on("orientationchange",function(){navbar_padding()});$(window).on("resize",function(){navbar_padding()});$(["img/icon/loading.gif"]).preload();if(url_page.match(/messagerie\.php/)){load_list();$(["css/images/loading.gif"]).preload()}$("#upload_b").on("change",function(g){var f=new FormData();var c=this.files[0];var d=5259999;if(c.size>d){$("#upload_ba").validationEngine("showPrompt","Votre fichier ne doit pas dépasser les 5Mo","error","topLeft",false,true)}else{f.append("file-avatar",c);$.ajax({url:"inc/add_user.php",type:"POST",data:f,processData:false,contentType:false,success:function(e){c_avatar();var h=JSON.parse(e);if(h[0]==true){$("#avatar_u").attr("src",h[1]);$(".dropdown-toggle > img:first-child").attr("src",h[1])}else{$("#upload_ba").validationEngine("showPrompt",h[1],"error","topLeft",false,true)}},xhr:function(){var e=$.ajaxSettings.xhr();e.upload.onloadstart=function(){i_avatar()};e.upload.onprogress=function(h){var j=Math.round(h.loaded/h.total*100);$(".progress-bar").attr("aria-valuenow",j);$(".progress-bar").css("width",j+"%");$(".progress-bar").html(j+"%")};e.upload.onload=function(){c_avatar()};e.upload.onabort=function(){c_avatar()};e.upload.onerror=function(){c_avatar()};return e}})}});$(".delete_serv").on("click",function(c){c.preventDefault();var d=$(this).attr("data-id");$("#modal_delete").remove();$("body").append('<div id="modal_delete" data-id="'+d+'" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="exampleModalLabel">Supprimer cette conversation ?</h4></div><div class="modal-body"><center>Êtes-vous sûr de vouloir effacer le service : <b>'+$(this).parents("tr").find(".serv_title").html()+'</b><br><button class="btn btn-success valid_modal">Oui</button> <button class="cancel_modal btn btn-danger">Non</button></center></div></div></div></div>');$("#modal_delete .valid_modal").on("click",function(f){f.preventDefault();$.getJSON("inc/add_services.php?delete="+d,function(e){if(e=="true"){$("#modal_delete").modal("hide");$('tr[data-ids="'+d+'"]').remove();if($("tr.bloc_services").length<1){$(".list_serv tbody").append('<tr class="bloc_services"><td colspan="4"><center>Vous n\'avez pas de services</center></td></tr>')}}else{$("#modal_delete").modal("hide")}})});$("#modal_delete .cancel_modal").on("click",function(f){f.preventDefault();$("#modal_delete").modal("hide")});$("#modal_delete").modal("show");$("#modal_delete").on("hidden.bs.modal",function(f){$(this).remove()})});$(".badge_").on("click",function(c){$('.badge_:not([data-id="'+$(this).attr("data-id")+'"])').removeClass("glow");$('.listing-s:not([data-s="'+$(this).attr("data-id")+'"])').hide();$('.listing-s[data-s="'+$(this).attr("data-id")+'"]').toggle();$(this).toggleClass("glow")});$(".popup_message, .talk-button").on("click",function(c){c.preventDefault();$("#modal_chat").modal("show");$("#modal_chat").on("hidden.bs.modal",function(d){$("#modal_chat .result_form").hide();$("#modal_chat .inner_form").show()})});if($(".tags-input").length>0){$(".tags-input").tagsinput({confirmKeys:[13,44,32,188]})}$("#searchbar").autocomplete({delay:280,source:function(d,c){$.ajax({url:"inc/search.php",dataType:"jsonp",data:{searchquery:d.term},success:function(e){c(e)}})},minLength:3,select:function(c,d){if(d.item.val){document.location.replace("services.php?searchbar=&type="+d.item.val)}if(d.item.userID){document.location.replace("profil.php?id="+d.item.userID)}},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});$("#zipbar").autocomplete({delay:280,source:function(d,c){$.ajax({url:"inc/search.php",dataType:"jsonp",data:{zipquery:d.term,extra:$("#zipbar").attr("data-s")},success:function(e){c(e)}})},minLength:3,select:function(c,d){},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});navbar_padding();$(".remind_link").bind("click",function(){if($(this).parents("#clone_login, .login-menu").find("#remind_section").css("display")=="none"){$(this).parents("#clone_login, .login-menu").find("#remind_section").css("display","block");$(this).parents("#clone_login, .login-menu").find("#login_section").css("display","none")}else{$(this).parents("#clone_login, .login-menu").find("#remind_section").css("display","none");$(this).parents("#clone_login, .login-menu").find("#login_section").css("display","block")}});$("#user_add").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:add_user_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#edit_user").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:edit_user_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#note_form").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:vote_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#user_remind").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:remind_change_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#modal_chat #send_message").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:send_popup_message,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#spec_contact").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:send_mail_contact,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$(".login_form").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:login_user_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$(".remind_form").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:remind_user_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});$("#spec_propose").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:add_service_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"});if($(".timepicker").length>0){$(".timepicker").datetimepicker({datepicker:false,format:"H:i",lang:"fr",value:$(this).val()})}$(".remove_dispo").on("click",function(){var c=$(this).attr("data-IDF");$(".dispo_field[data-IDF='"+c+"']").remove()});$(".add_dispo").on("click",function(f){f.preventDefault();var d=$(".dispo_field:last").attr("data-IDF");d++;var c='<span data-IDF="'+d+'" class="dispo_field"><select id="dispoday['+d+']" class="form-control days" name="dispoday['+d+']"><option value="all">Tous les jours</option><option value="weekend">Le week-end</option><option value="lun">Lundi</option><option value="mar">Mardi</option><option value="mer">Mercredi</option><option value="jeu">Jeudi</option><option value="ven">Vendredi</option><option value="sam">Samedi</option><option value="dim">Dimanche</option></select> <span class="toline-xs">entre <input autocomplete="off" size="5" maxlength="5" name="dispostart['+d+']" value="19:00" class="validate[required] time timepicker form-control" id="dispostart['+d+']" type="text"> et <input autocomplete="off" maxlength="5" name="dispoend['+d+']" name="dispoend['+d+']" class="time form-control validate[required,timeCheck[dispostart{'+d+'}]] timepicker" value="21:00" size="5" type="text"> <a class="remove_dispo" data-idf="'+d+'">Effacer</a></span></span>';$(c).insertAfter(".dispo_field:last");$(".timepicker").datetimepicker({datepicker:false,format:"H:i",lang:"fr",value:$(this).val()});$(".remove_dispo").on("click",function(){var e=$(this).attr("data-IDF");$(".dispo_field[data-IDF='"+e+"']").remove()})});modal_prevent();if(window.location.hash.match(/\#chat/gi)){window.location.hash="";$("#modal_chat").modal("show")}$("#message_send").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onBeforeAjaxFormValidation:function(){$("#message_send textarea").val("")},onAjaxFormComplete:message_send_function,showOneMessage:true,promptPosition:"topLeft"});$(".return_list").on("click",function(c){c.preventDefault();$("#list_m.cache").removeClass("cache");$("#content_m.montre").removeClass("montre")});$("#list_m input").on("keyup",function(d){var c=$(this).val();if(c.length>=3){$(this).addClass("onsearch");load_list(c)}else{if(c==""){$(this).removeClass("onsearch");load_list("")}else{if($(this).hasClass("onsearch")){$(this).removeClass("onsearch");load_list("")}}}})});function load_ajax_d(b,a){$form_b=$(b);if($form_b.find("#loader_ajax").length<1){$form_b.append('<div id="loader_ajax"><p><img src="img/icon/loading.gif" alt="" > envoie en cours...</p></div>')}return true}function send_mail_contact(a,d,c,b){if(c[0]==true){$form_b=$(d);$form_b.html('<div id="message_ajax"><p>Votre message a bien été envoyé à l’équipe de Swappy.</p></div>');$(document).scrollTop(0);return true}else{return false}}function add_user_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.html('<div id="message_ajax"><p>Bienvenue au sein de la communauté Swappy, vous êtes enfin inscrit ! Vous allez recevoir un mail afin de confirmer votre inscription.<br><br>Vérifiez dans vos indésirables en cas de non réception.</p></div>');$(document).scrollTop(0);return true}else{$form_b.find("#loader_ajax").remove();return false}}function vote_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.parent().html('<div id="message_ajax"><p>Merci. Nous vous remercions d\'avoir pris le soin de noter ce service</p></div>');$(document).scrollTop(0);return true}else{$form_b.find("#loader_ajax").remove();return false}}function edit_user_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.find("#loader_ajax").remove();$("#avatar_u").attr("src",c[1]);$(".dropdown-toggle > img:first").attr("src",c[1]);$ff=$form_b.find("input[type='submit']");$ff.validationEngine("showPrompt","Modifications éfféctuées !","pass","topLeft",false,true);return true}else{$form_b.find("#loader_ajax").remove();if(typeof(c[2])!="undefined"){$ff=$form_b.find("#"+c[2]+"");$ff.validationEngine("showPrompt",c[1],"error","topLeft",true,true)}else{$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true)}return false}}function remind_change_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.html('<div id="message_ajax"><p>Votre mot de passe a été changé !<br><br><i>Vous pouvez dès à présent vous connecter avec votre nouveau mot de passe.</i></p></div>');return true}else{$form_b.find("#loader_ajax").remove();$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true);return false}}function add_service_function(a,d,c,b){$form_b=$(d);if(c[0]==true){if($('input[name="ID_EDIT"]').length<1){$form_b.html('<div id="message_ajax"><p>Votre service a bien été ajouté. Vous pouvez le retrouver dans votre profil rubrique “Mes propositions”.</p></div>')}else{$form_b.html('<div id="message_ajax"><p>Votre service a bien été modifié. Vous pouvez retrouver les modifications dans votre profil rubrique “Mes propositions”.</p></div>')}$(document).scrollTop(0);return true}else{$form_b.find("#loader_ajax").remove();$form_b.find('input[type="submit"]').validationEngine("showPrompt",c[1],"error","topLeft",false,true);$(document).scrollTop(0);return false}}function send_popup_message(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.find("#loader_ajax").remove();$form_b.find(".result_form").html("<b>Message envoyé !</b>").show();$form_b.find(".inner_form").hide();$form_b.trigger("reset");setTimeout(function(){$("#modal_chat").modal("hide")},15000);return true}else{$form_b.find("#loader_ajax").remove();$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true);return false}}function login_user_function(a,d,c,b){$form_b=$(d);var e="";if(c[0]==true){if($form_b.find("input[name='to_url']").length>0&&$form_b.find("input[name='to_url']").val()!=""){e=$form_b.find("input[name='to_url']").val()}else{e=document.location.href}e=e.replace("?logout","").replace("&logout","").replace("&&","");if(!e.match(/\#chat/gi)){e=e.replace("#","")}document.location.replace(e);return true}else{$form_b.find("#loader_ajax").remove();$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true);return false}}function remind_user_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$form_b.find("#loader_ajax").remove();$("#modal_alert").remove();$("body").append('<div id="modal_alert" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="exampleModalLabel">Mot de passe perdu</h4></div><div class="modal-body">Un mail vous a été envoyé contenant un lien afin de changer le mot de passe de votre compte.<br><br><i>N\'oubliez pas de vérifier dans vos indésirables en cas de non réception</i></div></div></div></div>');$("#modal_alert").modal("show");$("#modal_alert").on("hidden.bs.modal",function(f){$(this).remove()});return true}else{$form_b.find("#loader_ajax").remove();$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true);return false}}function ZipFill(a){var b;if(isArray(a[2])){if($("input[name='cityname']").length>0){b=$("input[name='cityname']").parent();$("input[name='cityname']").remove();b.append("<select name='cityname' class='form-control auto_width'></select>")}$("select[name='cityname']").html("");for(i=0;i<a[2].length;i++){$("select[name='cityname']").append('<option value="'+a[2][i]+'">'+a[2][i]+"</option>")}}else{if($("select[name='cityname']").length>0){b=$("select[name='cityname']").parent();$("select[name='cityname']").remove();b.append("<input class='liketext' type='text' readonly name='cityname'>")}$("input[name='cityname']").val(a[2])}}function navbar_padding(){if($(document).width()>767){var e=$("#navbar").width();var b=$(".navbar-header").width();var d=$(".navbar-form").width()+$(".nav.navbar-nav:not(.navbar-right)").width()+$(".nav.navbar-nav.navbar-right").width();if((d+2)>=(e-b-15)){if($(".search_navbar:not(.moved-group)").length>0){$(".search_navbar:not(.moved-group)").addClass("moved-group");$("nav").height("100px")}}else{if($(".search_navbar.moved-group").length>0){$(".search_navbar.moved-group").removeClass("moved-group");$("nav").height("")}}}else{if($(".search_navbar.moved-group").length>0){$(".search_navbar.moved-group").removeClass("moved-group");$("nav").css("height","")}}var c=$("nav").height()+parseInt($("nav").css("margin-bottom").replace("px",""));$("body").css("padding-top",c+"px");var a=$(window).height();var f=($(document).height()-($("nav").height()-$("footer").height()-40));if(a>f&&((a-f)<-131)){$("#wrap").css("height","100%")}else{$("#wrap").removeAttr("style")}}function isArray(a){return(a.constructor.toString().indexOf("Array")!=-1)}function modal_prevent(){if($(".login_form").length>0){$('nav li a[href$="propose.php"], .interesse .popup_message, .talk_button').off();$('nav li a[href$="propose.php"], .interesse .popup_message, .talk-button').on("click",function(b){var c="";if($(this).attr("href")&&$(this).attr("href")!=""){c=$(this).attr("href")}else{if($(this).hasClass("popup_message")){var a=document.location.toString();a=a.replace(/\#(.*?)/gi,"");c=a+"&#chat"}}b.preventDefault();$("#modal_alert").remove();$("body").append('<div id="modal_alert" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="exampleModalLabel">Se connecter pour y accéder</h4></div><div class="modal-body">Désolé, mais la page à laquelle vous souhaitiez accéder n\'est pas accessible en tant que visiteur.<br><br>Veuillez vous inscrire/connecter pour l\'afficher.<div id="clone_login"></div></div></div></div></div>');$("#modal_alert").modal("show");$("#login_section").clone(true).appendTo("#clone_login");$("#remind_section").clone(true).appendTo("#clone_login");$("#clone_login").append('<a href="inscription.php" class="hidden_ notsigned">Pas encore inscrit ?</a><div class="clear"></div>');$("#clone_login .login_form").append("<input type='hidden' name='to_url' value='"+c+"'>");$("#modal_alert").on("hidden.bs.modal",function(d){$(this).remove()})})}else{$('nav li a[href$="propose.php"]').off();$(".interesse .popup_message").off();$(".interesse .popup_message").on("click",function(a){a.preventDefault();$("#modal_chat").modal("show");$("#modal_chat").on("hidden.bs.modal",function(b){$("#modal_chat .result_form").hide();$("#modal_chat .inner_form").show()})})}}function message_send_function(a,d,c,b){if(c[0]==true){$("#loader_ajax").remove();$form_b=$(d);$form_b.find("textarea[name='message_r']").val("");if(load_content($form_b.find("input[name='ID_Converse']").val(),$(".mess_t.active").html(),false,true)){load_list()}return true}else{$("#loader_ajax").remove();return false}}function date_send_function(a,d,c,b){$form_b=$(d);if(c[0]==true){$("#loader_ajax").remove();$("#m_date_modal").validationEngine("detach");$("#modal_date").modal("hide");if(load_content($("input[name='ID_Converse']").val(),$(".mess_t.active").html(),false)){load_list("load_with_reset_button")}return true}else{$("#loader_ajax").remove();$form_b.validationEngine("showPrompt",c[1],"error","topLeft",false,true);return false}}function load_list(b){if(typeof(b)=="undefined"){var b=""}var a=false;if(b=="load_with_reset_button"){b="";a=true}if(typeof(ajax_call)=="object"){ajax_call.abort()}if(b==""){$.ajaxSetup({async:false})}ajax_call=$.getJSON("inc/send_mess.php?list_message=&search="+b,function(d){var f="";var e="";var c='<span class="mess_count"></span>';$(".mess_t").remove();$.each(d,function(g,h){e="";c="";if(h.For>0){f='<a title="Voir l\'annonce" target="_blank" href="annonce.php?id='+h.For+'">'+h.Title+"</a>"}else{f="<i>discuter</i>"}if(h.Count>0){c='<span class="mess_count red">'+h.Count+"</span>"}if(h.ID==last_m){e=" active"}$("#list_m").append('<div data-b="'+h.Button+'" data-state="'+h.Status+'" data-id="'+h.ID+'" class="mess_t'+e+'"><a href="profil.php?id='+h.UserID+'">'+h.Name+'</a><br><span class="m_for">Pour : '+f+"</span>"+c+'<a title="Supprimer cette conversation" class="delete_m">X</a></div>')});delete_click();event_click();if(fst_l==1){load_content();fst_l=0}});$.ajaxSetup({async:true});if(a==true){button_f(0,true)}}function load_content(g,f,e,a){if(typeof(e)=="undefined"){var e=false}if(typeof(a)=="undefined"){var a=false}if(typeof(g)=="undefined"||g==""){var c=window.location.hash;if(c.match(/\#select\-/)){window.location.hash="";var g=c.replace(/\#select\-/,"");if($(".mess_t[data-id='"+g+"']").length>0){last_m=g;var f=$(".mess_t[data-id='"+g+"']").html();$(".mess_t[data-id='"+g+"']").addClass("active")}else{var g=$(".mess_t:first").attr("data-ID");last_m=g;var f=$(".mess_t:first").html();$(".mess_t:first").addClass("active")}}else{var g=$(".mess_t:first").attr("data-ID");last_m=g;var f=$(".mess_t:first").html();$(".mess_t:first").addClass("active")}}else{$("#list_m:not(.cache)").addClass("cache");$("#content_m:not(.montre)").addClass("montre");last_m=g}if($(".mess_t").length<1){$(".inner_m").html("<center><br>Vous n'avez aucun message</center>");$(".header_m span").html("");$(".form_m, .header_m").css("display","none");var g=0;mess_count(0,g)}else{var b=$(".mess_t[data-id='"+g+"']").attr("data-state");var d=$(".mess_t[data-id='"+g+"']").attr("data-b");$(".form_m, .header_m").css("display","");if(a==false){$(".inner_m").html('<center><img src="css/images/loading.gif" alt=""> Chargement...</center>')}$.ajaxSetup({async:false});$.getJSON("inc/send_mess.php?get_message="+g,function(h){$(".inner_m").html("");$(".header_m span").html(f);mess_count(h.count,g);$.each(h,function(j,k){if(typeof(k.Message)!="undefined"){var l="other";if(k.Author=="ME"){l="me"}if(k.Author=="BOT"){l="bot"}$(".inner_m").append('<div class="'+l+' msg">'+k.Message+'<span class="time">'+k.TimeText+"</span></div>")}});if(e==false){$(".inner_m").scrollTop($(".inner_m")[0].scrollHeight)}});$.ajaxSetup({async:true});$(".bot:last .valid-this-date").each(function(){$(this).addClass("actived");$(this).on("click",function(h){$(this).prepend('<img class="loader_link_m" alt="" src="css/images/loading.gif">');$.ajax({url:"inc/send_mess.php",data:"valid="+$(this).attr("data-id")+"&cc="+$("input[name='ID_Converse']").val(),method:"GET",success:function(j){$(".loader_link_m").remove();if(j=="true"){if(load_content($("input[name='ID_Converse']").val(),$(".mess_t.active").html(),false)){load_list("load_with_reset_button")}}}})})});$(".bot:last .refuse-this-date").each(function(){$(this).addClass("actived");$(this).on("click",function(h){$(this).prepend('<img alt="" class="loader_link_m" src="css/images/loading.gif">');$.ajax({url:"inc/send_mess.php",data:"refuse="+$(this).attr("data-id")+"&cc="+$("input[name='ID_Converse']").val(),method:"GET",success:function(j){$(".loader_link_m").remove();if(j=="true"){if(load_content($("input[name='ID_Converse']").val(),$(".mess_t.active").html(),false)){load_list("load_with_reset_button")}}}})})})}$(".form_m button").off("click");if(d==1){button_f(b,false,g)}else{$(".form_m button").html("");$(".form_m button").attr("disabled");$(".form_m button").css("display","none")}$("input[name='ID_Converse']").val(g);return true}function mess_count(a,b){if(a!="false"){$('div[data-id="'+b+'"] .mess_count').removeClass("red");$("input[name='message_r']").val("");if(a==0){$(".navbar-header .mess_count").removeClass("red").html("0");$(".nav-h .mess_count").removeClass("red").html("0");$(".dropdown-toggle .mess_count").remove()}else{$(".nav-h .mess_count:not(.red)").addClass("red");$(".navbar-header .mess_count:not(.red)").addClass("red");$(".nav-h .mess_count").html(a);$(".navbar-header .mess_count").html(a);if($(".dropdown-toggle .mess_count").length<1){$("<span class=''>"+a+"</span>").insertBefore(".dropdown-toggle .caret")}else{$(".dropdown-toggle .mess_count").html(a)}}}}function event_click(){$(".mess_t").off("click");$(".mess_t").on("click",function(b){var a=$(b.target);if(a.is("a")){return true}else{$(".mess_t.active").removeClass("active");$(this).addClass("active");load_content($(this).attr("data-id"),$(this).html());load_list("load_with_reset_button")}})}function make_date(b){var c=$("input[name='ID_Converse']").val();var a=$(".mess_t[data-id='"+c+"']");$("#m_date_modal").validationEngine("detach");if(a.attr("data-b")=="1"&&(a.attr("data-state")=="0"||a.attr("data-state")=="1")){$("#modal_date").remove();$.ajax({url:"inc/send_mess.php",type:"GET",dataType:"html",data:"make_date="+c,success:function(e){$("body").append('<div id="modal_date" data-id="'+c+'" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div></div></div></div>");$("#modal_date").modal("show");$("#modal_date").on("hidden.bs.modal",function(f){$("#m_date_modal").validationEngine("detach");$(this).remove()});var d=$("#date").val();$("#datepicker").datepicker({altField:"#date",minDate:0,maxDate:"+1Y"});$("#datepicker").datepicker("setDate",d);$("#hour").datetimepicker({datepicker:false,format:"H:i",lang:"fr",value:$("#hour").val()});$("#m_date_modal").validationEngine({ajaxFormValidation:true,ajaxFormValidationMethod:"post",onAjaxFormComplete:date_send_function,onBeforeAjaxFormValidation:load_ajax_d,showOneMessage:true,promptPosition:"topLeft"})}})}else{$("#modal_date").modal("hide")}}function delete_click(){$(".delete_m").on("click",function(a){var b=$(this).parent().attr("data-id");a.preventDefault();$("#modal_delete").remove();$("body").append('<div id="modal_delete" data-id="'+b+'" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="exampleModalLabel">Supprimer cette conversation ?</h4></div><div class="modal-body"><center><u>Êtes-vous sûr de vouloir effacer la conversation :</u> <br><br>'+$(this).parent().html()+'<br><button class="btn btn-success valid_modal">Oui</button> <button class="cancel_modal btn btn-danger">Non</button></center></div></div></div></div>');$("#modal_delete .valid_modal").on("click",function(c){c.preventDefault();var d=$(this).parents("#modal_delete").attr("data-id");$.getJSON("inc/send_mess.php?delete="+d,function(e){if(e=="true"){$("#modal_delete").modal("hide");fst_l=1;load_list()}else{var f=JSON.parse(JSON.stringify(e));$("#modal_delete").modal("hide");$("#message_send").validationEngine("showPrompt",f[1],"error","topLeft",false,true)}})});$("#modal_delete .cancel_modal").on("click",function(c){c.preventDefault();$("#modal_delete").modal("hide")});$("#modal_delete").modal("show");$("#modal_delete").on("hidden.bs.modal",function(c){$(this).remove()})})}function button_f(b,a,d){$(".form_m button").off("click");if(a==true){b=$(".mess_t.active").attr("data-state")}if(typeof(d)=="undefined"){var d=$(".mess_t.active").attr("data-id")}var c=$(".mess_t[data-id='"+d+"']").attr("data-b");if(c=="1"){if(b=="0"){$(".form_m button").html("FIXER UN RENDEZ-VOUS");$(".form_m button").css("display","");$(".form_m button").on("click",function(f){f.preventDefault();make_date($(this))})}if(b=="1"){$(".form_m button").html("CHANGER LE RENDEZ-VOUS");$(".form_m button").css("display","");$(".form_m button").on("click",function(f){f.preventDefault();make_date($(this))})}if(b=="2"){$(".form_m button").html("");$(".form_m button").attr("disabled");$(".form_m button").css("display","none")}if(b=="3"){$(".form_m button").html("");$(".form_m button").attr("disabled");$(".form_m button").css("display","none")}}}function blink_p(){clearTimeout(twinkle_);var a=document.title;if(a==title_page_){document.title="Vous avez "+c_message+" nouveau message(s) !"}else{document.title=title_page_}twinkle_=setTimeout(function(){blink_p()},1200)}function update_mess_count(){clearTimeout(time_out_m);if($(".login_form").length<1){$.getJSON("inc/add_user.php?count_mess",function(a){if(parseInt(a)<1){$(".nav-h .mess_count").removeClass("red");$(".navbar-header .mess_count").removeClass("red");$(".dropdown-toggle > .mess_count").remove();clearTimeout(twinkle_);document.title=title_page_;c_message=0}else{var b=parseInt($(".nav-h .mess_count").html());if(b!=parseInt(a)){c_message=parseInt(a);clearTimeout(twinkle_);if(focuset==false){blink_p()}}$(".nav-h .mess_count").addClass("red");$(".navbar-header .mess_count").addClass("red");if($("nav .dropdown-toggle > .mess_count").length<1){$("<span class='mess_count red'>"+a+"</span>").insertBefore("nav .dropdown-toggle > .caret")}else{$("nav .dropdown-toggle > .mess_count").html(a)}}time_out_m=setTimeout(function(){update_mess_count()},40000);$(".nav-h .mess_count").html(a);$(".navbar-header .mess_count").html(a);if(url_page.match(/messagerie\.php/)){if(load_content($("input[name='ID_Converse']").val(),$(".mess_t.active").html(),false,true)){load_list("load_with_reset_button")}}})}}function i_avatar(){$(".uploader-button").hide();$(".uploader-file-input").hide();$(".uploader-progress ").show();$(".uploader-side").css("opacity","1");$("#avatar_u").css("opacity","0.7");$(".progress-bar").attr("aria-valuenow","0");$(".progress-bar").css("width","0%");$(".progress-bar").html("0%")}function c_avatar(){$(".uploader-button").show();$(".uploader-file-input").show();$(".uploader-progress ").hide();$(".uploader-side").css("opacity","");$("#avatar_u").css("opacity","");$(".progress-bar").attr("aria-valuenow","0");$(".progress-bar").css("width","0%");$(".progress-bar").html("0%")}$.fn.preload=function(){this.each(function(){$("<img/>")[0].src=this})};function open_all_coms(){var a="";if(url_page.match(/annonce\.php/)){a=url_page.replace(/(.*?)annonce\.php(.*?)id=(.*?)([a-z]|\?|\&|\#|)/gi,"$3")}$("#modal_coms").remove();$.ajax({url:"inc/add_services.php",type:"GET",dataType:"html",data:"list_coms="+a,success:function(b){$("body").append('<div id="modal_coms" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true"><div class="modal-dialog modal-md"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="exampleModalLabel">Tous les commentaires</h4></div><div class="modal-body notes">'+b+'<div class="clear"></div></div></div></div></div>');$("#modal_coms").modal("show");$("#modal_coms").on("hidden.bs.modal",function(c){$(this).remove()})}})};
